{% extends "layout_bootstrap.html" %}
{% block head %}
	<script type="text/javascript" src="{{ url_for("static",filename="js/sorttable.js") }}"></script>


	<style>
    #dropArea {
      border: 2px dashed #ccc;
      margin: 10px;
      align-items: center;
      font-size: 18px;
      color: #aaa;
    }
  </style>
{% endblock %}
{% block body %}

<div class="body"> <!-- BASE contrainer -->

		
<div class="container"> {# Outer container #}
  <h3>Member Folder for {{ member.firstname }} {{ member.lastname}} </h3>
  {% if up is not none %}
  <a class="btn btn-outline-secondary glyphicon glyphicon-arrow-up" href="{{ url_for("memberFolders.folder")+up }}"></a>
  {% endif %}
  <span>{{ folder }}</span>
  
  <hr />
  <h3>Upload File</h3>
  <div id="dropArea">Drag and Drop Files Here to Upload</div>
  <hr />
  ...or click to browse and upload:
  <form method="post" enctype="multipart/form-data" action="{{ url_for("memberFolders.upload_file") }}">
    <input type="hidden" name="folder" value="{{ folder }}">
    <input type=file name=file>
    <input type=submit value=Upload>
   </form>
   <hr />
  <h3>Create Folder</h3>
  <form method="post" enctype="multipart/form-data" action="{{ url_for("memberFolders.createFolder") }}">
	  <label>Folder Name:</label>
    <input type="input" name="newname" value="">
    <input type="hidden" name="folder" value="{{ folder }}">
    <input type=submit value=Create>
   </form>
  <table id="fileTable" style="font-size:10px" class="table greenbar-table table-compact supercompact">
      <thead>
				<tr>
        <th>Filename  <i class="glyphicon glyphicon-sort"></i></th>
        <th>Last Modified  <i class="glyphicon glyphicon-sort"></i></th>
        <th></th>
        <th>Ext.  <i class="glyphicon glyphicon-sort"></i></th>
        <th>Size  <i class="glyphicon glyphicon-sort"></i></th>
        <th>Action</th>
      </thead>
  {% for f in files %}
     <tr>
      <td>{{ f['name'] }}</td>
      <td sortvalue={{ f['lastmod'] }}>{{ f['ago1'] }}</td>
      <td>{{ f['ago2'] }} Ago</td>

      {% if f['dir'] %}
        <td>Directory</td>
        <td sortvalue=0></td>
        <td><a href="{{ url_for("memberFolders.folder")+"/"+f['path'] }}/" class="btn btn-outline-secondary glyphicon glyphicon-folder-open"></a></td>
      {% else %}
        <td>{{ f['ext'] }}</td>
        <td sortvalue={{ f['size'] }}>{{ f['sizeText'] }}</td>
        <td><a href="{{ url_for("memberFolders.download",filename=f['path']) }}" class="btn btn-outline-secondary glyphicon glyphicon-download"></a></td>
      {% endif %}
    </tr>
  {% endfor %}
  </table>

  {% if files|length > 25 %}
  <hr />
  <h3>Upload File</h3>
  <form method="post" enctype="multipart/form-data" action="{{ url_for("memberFolders.upload_file") }}">
    <input type="hidden" name="folder" value="{{ folder }}">
    <input type=file name=file>
    <input type=submit value=Upload>
   </form>
   <hr />
  <h3>Create Folder</h3>
  <form method="post" enctype="multipart/form-data" action="{{ url_for("memberFolders.createFolder") }}">
	  <label>Folder Name:</label>
    <input type="input" name="newname" value="">
    <input type="hidden" name="folder" value="{{ folder }}">
    <input type=submit value=Create>
   </form>
   {% endif %}
</div>

<script type="text/javascript">
var t = new SortableTable(document.getElementById('fileTable'), 100);
</script>
<script>
	    function preventDefault(event) {
      event.preventDefault();
      event.stopPropagation();
    }

    function handleDrop(event) {
      preventDefault(event);

      const files = event.dataTransfer.files;
      handleFiles(files);
    }

    function handleFiles(files) {
      const fileList = Array.from(files);
      fileList.forEach(uploadFile);
    }

    function uploadFile(file) {
      const formData = new FormData();
      formData.append("file", file);

      // Replace 'your-upload-endpoint' with the URL where you handle file uploads on the server
	console.log("folder", "{{ folder }}");
      fetch("{{ url_for('memberFolders.upload_file2',folder=folder) }}", {
        method: "POST",
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          // Handle the server's response (if needed)
	  console.log("filder", "{{ folder }}");
          console.log("Upload successful:", data);
			const listItem = document.createElement('li');
      listItem.textContent = data['message'];
      document.getElementById("dropArea").appendChild(listItem);
			//window.location.href = '{{ url_for("memberFolders.uploaded",folder=folder) }}?message='+encodeURIComponent(data['message']);
        })
        .catch((error) => {
          console.error("Error uploading file:", error);
        });
    }

    document.getElementById("dropArea").addEventListener("dragover", preventDefault);
    document.getElementById("dropArea").addEventListener("dragenter", preventDefault);
    document.getElementById("dropArea").addEventListener("drop", handleDrop);
  </script>
</script>
{% endblock %}
